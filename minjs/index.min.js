var error="";var block_types=5;var score=0;var id_number=0;var clean_times=1;var Time=90;var background_music=$("#background_music")[0];var $start=$("#start");var $upload=$("#upload");var pointer=true;var pointers=false;var border0=e=>({border:e+"px solid #FFFFFF"});var clean_set=()=>{arr=$(".block");arr_length=arr.length;$cleanX=[];$cleanY=[]};var score1=0;var score2=0;var score3=0;var score4=0;var score5=0;var score6=0;var score7=0;var score8=0;var score9=0;var score10=0;$upload.addClass("hide");var page_width=document.body.clientWidth;var page_height=document.body.clientHeight;if(page_height>page_width){var screen_type="mobile"}else{var screen_type="PC"}window.onresize=function(){if(screen_type=="mobile"&&document.body.clientWidth>document.body.clientHeight){window.location.reload()}if(screen_type=="PC"&&document.body.clientWidth<document.body.clientHeight){window.location.reload()}};var title1=new Vue({el:"#title1",data:{msg:"Fightだよ"}});var c_score=new Vue({el:"#c_score",data:{data1:0,data2:0,data3:0,data4:0,data5:0,data6:0,data7:0,data8:0,data9:0,data10:0}});var $play_area=$("#play_area");var $play_area1=$("#play_area1");var $bottom=$("#bottom");var $title1=$("#title1");var $title2=$("#title2");if(screen_type=="mobile"){$bottom.css({transform:"translateY(-100%)",top:"100%",left:"0%",width:"100%",height:"auto"});$title1.css({top:"10%",left:"50%","font-size":page_width*.08+"px"});$title2.css({top:"20%",left:"50%","font-size":page_width*.05+"px"});$play_area.css({height:page_height*.7+"px",width:page_height*.7+"px"});$(".input").css({height:"1%",width:"5%"})}else{$bottom.css({transform:"translateY(-100%) translateX(-50%)",top:"100%",left:"50%",width:page_height*.5+20+"px",height:"auto"});$title1.css({top:"2%",left:"50%","font-size":page_height*.08+"px"});$title2.css({top:"13%",left:"50%","font-size":page_height*.04+"px"});$play_area.css({height:page_height*.5+"px",width:page_height*.5+"px"});$(".input").css({height:"1%",width:"3%"})}var error=error+"main";function clean(){clean_set();for(var i0=0;i0<arr_length;i0++){var $arr=$(arr[i0]);var numX=1;var numY=1;var $element_totalX=[];var $element_totalY=[];var x0=$arr.data("x");var y0=$arr.data("y");var type0=$arr.data("type");var special0=$arr.data("special");var el="#"+$arr.attr("id");if(y0<1){continue}if($arr.hasClass("cleanX")!=true){var times=line-x0+1;for(var i=1;i<times;i++){var $element="#"+$(".block[data-x="+(x0+i)+"][data-y="+y0+"]").attr("id");if($($element).data("type")==type0){$element_totalX.push($element);numX=++numX}else{break}}}if($arr.hasClass("cleanY")!=true){var times=column-y0+1;for(var i=1;i<times;i++){var $element="#"+$(".block[data-x="+x0+"][data-y="+(y0+i)+"]").attr("id");if($($element).data("type")==type0){$element_totalY.push($element);numY=++numY}else{break}}}if(numX>2){$arr.addClass("clean cleanX");$cleanX.push(el);var $element_totalX_length=$element_totalX.length;for(i1=0;i1<$element_totalX_length;i1++){$($element_totalX[i1]).addClass("clean cleanX");$cleanX.push($element_totalX[i1])}window["score"+type0]=eval("score"+type0)+numX;score=score+numX*(numX-1)*50*clean_times;clean_times=clean_times+.5}if(numY>2){$arr.addClass("clean cleanY");$cleanY.push(el);var $element_totalY_length=$element_totalY.length;for(i1=0;i1<$element_totalY_length;i1++){$cleanY.push($element_totalY[i1]);$($element_totalY[i1]).addClass("clean cleanY")}window["score"+type0]=eval("score"+type0)+numY;score=score+numY*(numY-1)*50*clean_times;clean_times=clean_times+.5}}var $clean=$(".clean");spawn1($clean);$clean.css({transform:"scale(0)"});setTimeout(function(){$clean.remove();title2.score=score;set_score(true);scan()},310);arr.css({"pointer-events":"none"});pointer=false}function scan(){clean_set();for(var a=0;a<arr_length;a++){var e=false;var t=$(arr[a]).data("x");var r=$(arr[a]).data("y");while(r<column){var l=$(".block[data-x="+t+"][data-y="+(r+1)+"]").attr("id");if(l==undefined){var r=++r;$(arr[a]).attr({"data-y":r});$(arr[a]).data("y",r);var e=true}else{break}}if(e){$(arr[a]).css({top:1/column*(r-1)*$play_area.height()+"px"})}}for(var a=0;a<arr_length;a++){var e=false;var t=$(arr[a]).data("x");var r=$(arr[a]).data("y");while(r<column){var l=$(".block[data-x="+t+"][data-y="+(r+1)+"]").attr("id");if(l==undefined){var r=++r;$(arr[a]).attr({"data-y":r});$(arr[a]).data("y",r);var e=true}else{break}}if(e){$(arr[a]).css({top:1/column*(r-1)*$play_area.height()+"px"})}}var n=found();if(n){setTimeout(function(){clean()},300)}else{clean_times=1;setTimeout(function(){arr.css({"pointer-events":"auto"});pointer=true;if(time==0){over()}},310)}}function scan1(){var a=$(".block[data-y=-5]");var e=a.length;for(var t=0;t<e;t++){var r=$(a[t]);var l=r.data("x");var n=r.data("y");while(n<column){var i=$(".block[data-x="+l+"][data-y="+(n+1)+"]").attr("id");if(i==undefined){var n=++n;r.attr({"data-y":n});r.data("y",n)}else{break}}var n=r.data("y");while(n<column){var i=$(".block[data-x="+l+"][data-y="+(n+1)+"]").attr("id");if(i==undefined){var n=++n;r.attr({"data-y":n});r.data("y",n)}else{break}}}}function clean1(){clean_set();for(var a=0;a<arr_length;a++){var e=$(arr[a]);var t=1;var r=1;var l=[];var n=[];var i=e.data("x");var c=e.data("y");var s=e.data("type");var o="#"+e.attr("id");if(c<=0){continue}var v=line-i+1;for(var d=1;d<v;d++){var u="#"+$(".block[data-x="+(i+d)+"][data-y="+c+"]").attr("id");var m=$(u).data("type");if(m==s){l.push(u);t=++t}else{break}}var v=column-c+1;for(var d=1;d<v;d++){var u="#"+$(".block[data-x="+i+"][data-y="+(c+d)+"]").attr("id");var m=$(u).data("type");if(m==s){n.push(u);r=++r}else{break}}if(t>2){$cleanX.push(o);var f=l.length;for(i1=0;i1<f;i1++){$cleanX.push(l[i1])}}if(r>2){$cleanY.push(o);var y=n.length;for(i1=0;i1<y;i1++){$cleanY.push(n[i1])}}}$cleanX_length=$cleanX.length;for(i2=1;i2<$cleanX_length;i2=i2+2){var p=$($cleanX[i2]).data("type");if(p==block_types){var p=1}else{var p=p+1}$($cleanX[i2]).data("type",p);$($cleanX[i2]).attr({"data-type":p,src:"textures/"+p+".png"})}$cleanY_length=$cleanY.length;for(i2=1;i2<$cleanY_length;i2=i2+2){var p=$($cleanY[i2]).data("type");if(p==block_types){var p=1}else{var p=p+1}$($cleanY[i2]).data("type",p);$($cleanY[i2]).attr({"data-type":p,src:"textures/"+p+".png"})}var h=found();if(h){clean1()}else{}}var error=error+" clean";$start.click(function(){start()});$upload.click(function(){upload()});var title2=new Vue({el:"#title2",data:{score:0,time:""}});function changed(){var a=$(".block");var e=a.length;for(var t=0;t<e;t++){var r=new Vue({el:a[t],data:{},methods:{clicked:function(a){var e=$("#"+a.currentTarget.id);if(e.data("y")<1){}else{if(e.hasClass("check")){e.css(border0(0));e.removeClass("check")}else{e.css(border0(5));e.addClass("check");change1(e)}}}}})}}function change1(a){var e=$(".checked");if(e.attr("id")==a.attr("id")){return 0}var t=0;if(e.height()!="undefined"){var r=a.data("x");var c=a.data("y");if(Math.abs(r-e.data("x"))==1&&c-e.data("y")==0){var t=++t}if(Math.abs(c-e.data("y"))==1&&r-e.data("x")==0){var t=++t}if(t==1){var s=a.data("x");var o=a.data("y");var d=e.data("x");var i=e.data("y");a.attr({"data-x":d,"data-y":i});a.data("x",d);a.data("y",i);$(".checked").attr({"data-x":s,"data-y":o});e.data("x",s);e.data("y",o);var l=a.position().left;var n=a.position().top;var v=e.position().left;var f=e.position().top;var u=found();if(u){a.css({left:v,top:f});e.css({left:l,top:n});setTimeout(function(){clean()},300)}else{a.attr({"data-x":s,"data-y":o});a.data("x",s);a.data("y",o);e.attr({"data-x":d,"data-y":i});e.data("x",d);e.data("y",i)}a.css(border0(0));e.css(border0(0));a.removeClass("checked check");e.removeClass("checked check")}else{e.css(border0(0));e.removeClass("checked check");a.addClass("checked")}}else{a.addClass("checked")}}function found(){var a=$(".block");var e=a.length;for(var t=0;t<e;t++){var r=$(a[t]);var c=1;var s=1;var o=r.data("x");var d=r.data("y");var i=r.data("type");var l="#"+r.attr("id");if(d<=0){continue}var n=line-o+1;for(var v=1;v<n;v++){var f="#"+$(".block[data-x="+(o+v)+"][data-y="+d+"]").attr("id");var u=$(f).data("type");if(u==i){c=++c}else{break}}var n=column-d+1;for(var v=1;v<n;v++){var f="#"+$(".block[data-x="+o+"][data-y="+(d+v)+"]").attr("id");var u=$(f).data("type");if(u==i){s=++s}else{break}}if(c>2||s>2){return true}}return false}function start(){$start.addClass("hide");$upload.addClass("hide");$play_area1.empty();spawn();setTimeout(function(){changed();clean1();$(".block").css({opacity:"1"})},50);background_music.play();score=0;title2.score=0;time=Time;set_score(false);clock=setInterval(function(){if(time!=0){time=time-1;title2.time=time}if(time==0&&pointer){over()}},1e3)}function over(){$(".block").addClass("hide");$start.removeClass("hide");$upload.removeClass("hide");clearInterval(clock)}function upload(){var a=title2.score;var e=$("#player_name").val();var t=$("#player_id").val();if(a&&e&&t){var r=new Date;var c=r.getYear()+1900;var s=r.getMonth()+1;var o=r.getDate();var d=r.getHours();var i=r.getMinutes();var l=r.getSeconds();var n=c+"-"+s+"-"+o+"_"+d+":"+i+":"+l;$.post("../main.php",{names:e,scores:a,dates:n,players:t},function(a,e){$("#list").empty();$("#list").append(a);alert(e)})}else{alert("请输入昵称与id")}}function set_score(a){if(a){c_score.data1=score1;c_score.data2=score2;c_score.data3=score3;c_score.data4=score4;c_score.data5=score5;c_score.data6=score6;c_score.data7=score7;c_score.data8=score8;c_score.data9=score9;c_score.data10=score10}else{score1=0;score2=0;score3=0;score4=0;score5=0;score6=0;score7=0;score8=0;score9=0;score10=0;c_score.data1=0;c_score.data2=0;c_score.data3=0;c_score.data4=0;c_score.data5=0;c_score.data6=0;c_score.data7=0;c_score.data8=0;c_score.data9=0;c_score.data10=0}}var error=error+" control";var line=9;var column=9;var numbers=line*column;var $vue_area=new Vue({el:"#play_area1",data:{tag:""}});size();function size(){if(line>=column){mode=true}else{mode=false}if(screen_type=="mobile"){if(mode){$play_area.css({width:page_width*.7+"px",height:page_width*.7/line*column+"px"})}else{$play_area.css({height:page_width*.7+"px",width:page_width*.7/column*line+"px"})}}else{if(mode){$play_area.css({width:page_height*.5+5+"px",height:page_height*.5/line*column+5+"px"})}else{$play_area.css({height:page_height*.5+5+"px",width:page_height*.5/column*line+5+"px"})}}}function spawn(){size();if(mode){var a=100/line*.01*$play_area.width()+"px";var e="auto"}else{var e=100/column*.01*$play_area.height()+"px";var a="auto"}block_size="height:"+a+";"+"width:"+e+';"';for(var r=column*-3;r<numbers;r++){id_number=id_number+1;var l="id='block"+id_number+"' ";var i=Math.floor(Math.random()*block_types+1);var t='src="textures/'+i+'.png"';var s='style="top: '+1/column*Math.floor(r/line)*$play_area.height()+"px; "+"left: "+1/line*(Math.abs(r)%line)*$play_area.width()+"px;opacity:0;";var c='data-x="'+(1+Math.abs(r)%line)+'" ';if(r>=0){var n='data-y="'+(1+Math.floor(r/line))+'" '}else{var n='data-y="'+Math.floor(r/line)+'" '}var o='data-type="'+i+'"';var h='data-special="0"';var p='@click="clicked($event)"';if(r>column*-3){var d='<img class="block'+'" '+t+l+s+block_size+c+n+o+h+p+">"+d}else{var d='<img class="block'+'" '+t+l+s+block_size+c+n+o+h+p+">"}}$vue_area.tag=d}function spawn1(a){var e=[];var r=a.length;for(var l=0;l<r;l++){var i=$(a[l]).data("x");id_number=id_number+1;e.push(id_number);var t="id='block"+id_number+"' ";var s=Math.floor(Math.random()*block_types+1);var c='src="textures/'+s+'.png"';var n='style="top: '+1/column*-9*$play_area.height()+"px; "+"left: "+1/line*(i-1)*$play_area.width()+"px;";var o='data-x="'+i+'" ';var h='data-y="'+'-5"';var p='data-type="'+s+'"';var d='data-special="0"';var v='@click="clicked($event)"';if(l>0){var _='<img class="block'+'" '+c+t+n+block_size+o+h+p+d+v+">"+_}else{var _='<img class="block'+'" '+c+t+n+block_size+o+h+p+d+v+">"}}$("#play_area1").append(_);scan1();var u=e.length;for(var l=0;l<u;l++){new_set(e[l])}}function new_set(a){var e=new Vue({el:"#block"+a,data:{},methods:{clicked:function(a){var e=$("#"+a.currentTarget.id);if(e.data("y")<1){}else{if(e.hasClass("check")){e.css(border0(0));e.removeClass("check")}else{e.css(border0(5));e.addClass("check");change1(e)}}}}})}var error=error+" spawn";function skill1(a,l){if(a<4){return over}$spe=$(l[1]);$spe.removeClass("clean cleanX cleanY");$spe.data("special",1);$spe.attr({"data-special":1,src:"textures/special1.png"})}function skill2(){}function skill3(){}function skill4(){}function skill5(){}function special1(a){var l=a.data("x");var c=a.data("y");boom(l,c)}function special2(){}function special3(){}function special4(){}function special5(){}function boom(a,l){$(".block[data-x="+(a+1)+"][data-y="+l+"]").addClass("clean");$(".block[data-x="+(a-1)+"][data-y="+l+"]").addClass("clean");$(".block[data-x="+a+"][data-y="+(l+1)+"]").addClass("clean");$(".block[data-x="+a+"][data-y="+(l-1)+"]").addClass("clean")}var error=error+" skill";